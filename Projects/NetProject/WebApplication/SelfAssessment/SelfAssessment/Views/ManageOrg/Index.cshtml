
@{
    ViewBag.Title = "Index";
}

<div class="content mt-3">

    <div class="col-sm-12">
        <div class="card">
            <div class="card-header">
                <strong>Organization Registration List</strong>
                <br />
                <h3<label id="lblSucess" ></label></h3>
            </div>

            <div class="card-body card-block">
                @*<form action="" method="post" class="form-horizontal">*@
                <div class="row form-group">

                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">State</label></div>
                    <div class="col-12 col-md-3">
                        @Html.DropDownList("State", (IEnumerable<SelectListItem>)ViewBag.State, new { @class = "form-control" })
                    </div>

                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">City</label></div>
                    <div class="col-12 col-md-3">
                        @Html.DropDownList("City", (IEnumerable<SelectListItem>)ViewBag.City, new { @class = "form-control" })
                    </div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Sector</label></div>
                    <div class="col-12 col-md-3">
                        @Html.DropDownList("Sector", (IEnumerable<SelectListItem>)ViewBag.SectorList, new { @class = "form-control" })
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Sub Sector</label></div>
                    <div class="col-12 col-md-3">
                        @Html.DropDownList("SubSector", (IEnumerable<SelectListItem>)ViewBag.SubSectorList, new { @class = "form-control" })
                    </div>

                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Revenue</label></div>
                    <div class="col-12 col-md-3">
                        @Html.DropDownList("Revenue", (IEnumerable<SelectListItem>)ViewBag.Revenue, new { @class = "form-control" })
                    </div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Type Of Services </label></div>
                    <div class="col-12 col-md-3">
                        @Html.DropDownList("TypeOfService", (IEnumerable<SelectListItem>)ViewBag.TypeOfService, new { @class = "form-control" })
                    </div>
                </div>

                <div class="row form-group text-center">
                    <div class="col-12 col-md-12">
                        &nbsp;&nbsp;
                        <button id="btnGetOrganization" type="submit" class="btn btn-primary btn-sm">
                            <i class="fa fa-dot-circle-o"></i> Go
                        </button>
                        <button type="reset" class="btn btn-danger btn-sm">
                            <i class="fa fa-ban"></i> Reset
                        </button>
                        <button type="button" class="btn btn-primary btn-sm" id="btnEnableAll">
                            <i class="fa fa-ban"></i> EnableAll
                        </button>
                    </div>

                </div>
                @*</form>*@
            </div>

        </div>
    </div>

    <div class="col-sm-12" id="divOrganizationAddEditForm" style="display:none;">
        <div class="card">
            <div class="card-header">
                <strong>DETAILS</strong>
            </div>
            <form action="" method="post" class="form-horizontal">
                <div class="card-body card-block">

                    <input type="hidden" id="txtId" name="text-input" placeholder="Text" class="form-control" />

                    <div class="row form-group" style="text-align:center">

                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Name</label></div>
                        <div class="col-12 col-md-3">
                            <input type="text" class="form-control" id="txtName">
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Address</label></div>
                        <div class="col-12 col-md-3">
                            <input type="text" class="form-control" id="txtAddress">
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Contact Name</label></div>
                        <div class="col-12 col-md-3">
                            <input type="text" class="form-control" id="txtContactName">
                        </div>
                    </div>
                    <div class="row form-group" style="text-align:center">
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Designation</label></div>
                        <div class="col-12 col-md-3">
                            <input type="text" class="form-control" id="txtDesignation">
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Email</label></div>
                        <div class="col-12 col-md-3">
                            <input type="text" class="form-control" id="txtEmail">
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Contact No</label></div>
                        <div class="col-12 col-md-3">
                            <input type="text" class="form-control" id="txtContactNo">
                        </div>
                    </div>
                    <div class="row form-group" style="text-align:center">
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">City</label></div>
                        <div class="col-12 col-md-3">
                            @Html.DropDownList("txtCity", (IEnumerable<SelectListItem>)ViewBag.City, new { @class = "form-control" })
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">State</label></div>
                        <div class="col-12 col-md-3">
                            @Html.DropDownList("txtState", (IEnumerable<SelectListItem>)ViewBag.State, new { @class = "form-control" })
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Sector</label></div>
                        <div class="col-12 col-md-3">
                            @Html.DropDownList("txtSector", (IEnumerable<SelectListItem>)ViewBag.SectorList, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="row form-group" style="text-align:center">
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Sub sector</label></div>
                        <div class="col-12 col-md-3">
                            @Html.DropDownList("txtSubSector", (IEnumerable<SelectListItem>)ViewBag.TxtSubSector, new { @class = "form-control" })
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Revenue</label></div>
                        <div class="col-12 col-md-3">
                            @Html.DropDownList("txtRevenue", (IEnumerable<SelectListItem>)ViewBag.Revenue, new { @class = "form-control" })
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">TypeOfService</label></div>
                        <div class="col-12 col-md-3">
                            @Html.DropDownList("txtTypeOfService", (IEnumerable<SelectListItem>)ViewBag.TypeOfService, new { @class = "form-control" })
                        </div>
                    </div>

                    <div class="row form-group" style="text-align:center">
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Status</label></div>
                        <div class="col-12 col-md-3">
                            @Html.DropDownList("Status", (IEnumerable<SelectListItem>)ViewBag.Status, new { @class = "form-control" })
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">New Password</label></div>
                        <div class="col-12 col-md-3">
                            <input type="text" class="form-control" id="txtPassword">
                        </div>
                        <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Retype - Password</label></div>
                        <div class="col-12 col-md-3">
                            <input type="text" class="form-control" id="txtRetypePassword">
                        </div>

                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" id="btnUpdateOrganization" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary" id="frmAddEditClose">Cancel</button>
                </div>
            </form>
        </div>
    </div>


    <div class="col-sm-12" id="divOrganizationViewForm" style="display:none">
        <div class="card">
            <div class="card-header">
                <strong>DETAILS</strong>
            </div>
            <div class="card-body card-block">

                <div class="row form-group">

                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Name </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblName">
                        : Name
                    </div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Address </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblAddress">
                        : Address
                    </div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Contact Name </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblContactName">
                        : Contact Name
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Designation </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblDesignation">
                        : Desgination
                    </div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Email </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblEmail">
                        : Email
                    </div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Contact No </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblContactNo">
                        : Contact No
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col col-md-1 "><label for="hf-password" class=" form-control-label">City </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblCity"> : City</div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">State </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblState"> : State</div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Sector </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblSector"> : Sector</div>
                </div>
                <div class="row form-group">
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Sub sector </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblSubSector"> : Sub Sector</div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">Revenue </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblRevenue"> : Revenue</div>
                    <div class="col col-md-1"><label for="hf-password" class=" form-control-label">TypeOfService </label></div>
                    <div class="col-12 col-md-3 fontweight700" id="lblTypeOfService"> : TypeOfService</div>
                </div>
            </div>

            <div class="modal-footer">

                <button type="button" class="btn btn-secondary" id="btnViewClose">Cancel</button>
            </div>

        </div>
    </div>


    <div class="col-lg-12">
        <div class="card">

            <form action="" method="post" class="form-horizontal" id="formEnable">
                <input type="hidden" id="hdnaction" name="hdnaction" value="" />
                <div class="card-body">
                    <table id="bootstrap-data-table" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th><input type="checkbox" name="chk1" id="CheckAll"></th>
                                <th>Organization</th>
                                <th>City</th>
                                <th>State</th>
                                <th>Type of Services</th>
                                <th>Sector</th>
                                <th>Sub Sector</th>
                                <th>Revenue</th>
                                <th>Option's</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="~/Admin/assets/js/vendor/jquery-2.1.4.min.js"></script>
<script src="~/Admin/assets/js/popper.min.js"></script>
<script src="~/Admin/assets/js/plugins.js"></script>
<script src="~/admin/assets/js/lib/data-table/datatables.min.js"></script>
<script src="~/admin/assets/js/lib/data-table/dataTables.bootstrap.min.js"></script>
<script src="~/admin/assets/js/lib/data-table/dataTables.buttons.min.js"></script>
<script>

    $(document).ready(function () {

        $("#btnEnableAll").click(function () {

            var values = new Array();
            
            $.each($("input[class='checkbox']:checked"), function () {
                var data = $(this).parents('tr:eq(0)');
                    values.push(data.find('td:eq(0)').text());
            });

            if (values.length <= 0)
                return;

            var enableUserIds = values.join("$");

             $.ajax({
                type: "GET",
                 url: API.OrganizationEnable() + enableUserIds,
                contentType: "application/json"
            }).done(function (res) {
                    $('#lblSucess').text(res);
                });
        });

        $("#CheckAll").change(function () {  //"select all" change
            $(".checkbox").prop('checked', $(this).prop("checked")); //change all ".checkbox" checked status
        });

        //".checkbox" change
        $('.checkbox').change(function () {
            //uncheck "select all", if one of the listed checkbox item is unchecked
            if (false == $(this).prop("checked")) { //if this item is unchecked
                $("#CheckAll").prop('checked', false); //change "select all" checked status to false
            }
            //check "select all" if all checkbox items are checked
            if ($('.checkbox:checked').length == $('.checkbox').length) {
                $("#CheckAll").prop('checked', true);
            }
        });


        $("#btnAddOrganization").click(function () {
            $("#divOrganizationViewForm").hide();
            $("#divOrganizationAddEditForm").show();
        });

        $("#btnOrganizationEditForm").click(function () {
            $("#divOrganizationViewForm").hide();
            $("#divOrganizationAddEditForm").show();
        });

        $("#frmAddEditClose").click(function () {
            $("#divOrganizationAddEditForm").hide();
        });
        $("#btnCancel").click(function () {
            $("#divQuestionAddEditForm").hide();
        });

        $("#frmViewClose").click(function () {
            $("#divOrganizationViewForm").hide();
        });

        $("#btnViewClose").click(function () {
            $("#divOrganizationViewForm").hide();
        });

        $("#btnOrganizationViewForm").click(function () {
            $("#divOrganizationViewForm").show();
            $("#divOrganizationAddEditForm").hide();
        });

        $('#Sector').on('change', function () {
            //if ($(this).val() == "1000") {
            //    $('#divOthers').show();
            //    $('#txtSector').show();
            //}
            //else {
            $.ajax({
                type: "GET",
                url: API.GetSubSectors() + $(this).val(),
                contentType: "application/json"
            }).done(function (res) {
                $.each(res, function (key, value) {
                    $('#SubSector')
                        .append($("<option></option>")
                            .attr("value", value.Value)
                            .text(value.Text));
                });
            });
            //$('#divOthers').hide();
            //$('#txtSector').hide();
            //}
        });

        $("#btnUpdateOrganization").click(function () {

            if ($("#txtPassword").val() != $("#txtRetypePassword").val()) {
                alert("Password and RetypePassword should match");
                return;
            }

            var model = {
                Id: $("#txtId").val(),
                Name: $("#txtName").val(),
                Address: $("#txtAddress").val(),
                ContactName: $("#txtContactName").val(),
                Designation: $("#txtDesignation").val(),
                Email: $("#txtEmail").val(),
                MobileNo: $("#txtContactNo").val(),
                City: $("#txtCity").val(),
                State: $("#txtState").val(),
                Sector: $("#txtSector").val(),
                SubSector: $("#txtSubSector").val(),
                Revenue: $("#txtRevenue").val(),
                TypeOfService: $("#txtTypeOfService").val(),
                Password: $("#txtPassword").val(),
                IsActive: $("#Status").val()
            }

            $.ajax({
                type: "POST",
                data: JSON.stringify(model),
                url: API.OrganizationUpdate(),
                contentType: "application/json"
            }).done(function (res) {

                var tr = $('#bootstrap-data-table td:contains(' + model.Id + ')').parent('tr');
                $(tr).find("td").eq(2).text(model.Name);
                $(tr).find("td").eq(3).text($("#txtCity [value=" + model.City + "]").text());
                $(tr).find("td").eq(4).text($("#txtState [value=" + model.State + "]").text());
                $(tr).find("td").eq(5).text($("#txtTypeOfService [value=" + model.TypeOfService + "]").text());
                $(tr).find("td").eq(6).text($("#txtSector [value=" + model.Sector + "]").text());
                $(tr).find("td").eq(7).text($("#txtSubSector [value=" + model.SubSector + "]").text());
                $(tr).find("td").eq(8).text($("#txtRevenue [value=" + model.Revenue + "]").text());

                $("#divOrganizationAddEditForm").hide();
            });

        });

        $("#btnGetOrganization").click(function () {
            model = {
                CityId: $('#City').val(),
                StateId: $('#State').val(),
                SectorId: $('#Sector').val(),//txtSector, txtSubSector
                SubSectorId: $('#SubSector').val(),
                RevenueId: $('#Revenue').val(),
                TypeId: $('#TypeOfOrg').val(),
                TypeOfServiceId: $('#TypeOfService').val()
            };

            $.ajax({
                type: "POST",
                data: JSON.stringify(model),
                url: API.OrganizationGet(),
                contentType: "application/json"
            }).done(function (res) {
                $("#bootstrap-data-table tbody").empty();
                $.each(res, function (key, value) {
                    var markup = "<tr><td>" + value.Id + "</td>" + "<td><input id=" + value.Id + " class='checkbox' checked=" + value.IsActive +" type='checkbox' name='chk1'></td>" + "<td>"
                        + value.Name + "</td><td>" + value.City + "</td><td>" + value.State + "</td><td>" + value.TypeOfService + "</td><td>"
                        + value.Sector + "</td><td>" + value.SubSector + "</td><td>" + value.Revenue + "</td><td>"
                        + "<a href='#' class='btn btn-warning btn-sm' onclick=GetOrg(" + value.Id + ",'Edit');> <i class='fa fa-pencil'></i></a>"
                        + "&nbsp;&nbsp;<a href='#' class='btn btn-info btn-sm' id='btnGroupViewForm' onclick=GetOrg(" + value.Id + ",'View');><i class='fa fa-eye'></i></a>"
                        + "&nbsp;&nbsp;<a href='#' class='btn btn-danger btn-sm' id='btnDeleteGroup' onclick=DeleteOrg(" + value.Id + ");> <i class='fa fa-trash-o'></i></a></td>";
                    $("#bootstrap-data-table tbody").append(markup);
                });
                $('#bootstrap-data-table').DataTable();
            });

        });
    });

    function GetOrg(id, type) {
        //var url = API.OrganizationView();
        $.ajax({
            type: "GET",
            data: { id: id, type: type },
            url: API.OrganizationView(),
            contentType: "application/json"
        }).done(function (result) {
            if (type == "View") {
                $("#lblName").text(result.Name);
                $("#lblAddress").text(result.Address);
                $("#lblContactName").text(result.ContactName);
                $("#lblDesignation").text(result.Designation);
                $("#lblEmail").text(result.Email);
                $("#lblContactNo").text(result.MobileNo);
                $("#lblCity").text(result.City);
                $("#lblState").text(result.State);

                $("#lblSector").text(result.Sector);
                $("#lblSubSector").text(result.SubSector);
                $("#lblRevenue").text(result.Revenue);
                $("#lblTypeOfService").text(result.TypeOfService);

                $("#divOrganizationViewForm").show();
                $("#divOrganizationAddEditForm").hide();
            }
            else {
                $("#txtId").val(result.Id);
                $("#txtName").val(result.Name);
                $("#txtAddress").val(result.Address);
                $("#txtContactName").val(result.ContactName);
                $("#txtDesignation").val(result.Designation);
                $("#txtEmail").val(result.Email);
                $("#txtContactNo").val(result.MobileNo);

                $("#txtCity").val(result.City);
                $("#txtState").val(result.State);
                $("#txtSector").val(result.Sector);
                $("#txtSubSector").val(result.SubSector);
                $("#txtRevenue").val(result.Revenue);
                $("#txtTypeOfService").val(result.TypeOfService);

                $("#divOrganizationViewForm").hide();
                $("#divOrganizationAddEditForm").show();
            }
        });
    }
    function DeleteOrg(id) {
        //var url = API.OrganizationDelete() + id;
        $.ajax({
            type: "GET",
            url: API.OrganizationDelete() + id,
            contentType: "application/json"
        }).done(function (result) {
            $('#bootstrap-data-table td:contains(' + id + ')').parent('tr').remove();
        });
    }
</script>